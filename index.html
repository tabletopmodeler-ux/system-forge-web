...
<div class="row">
  <button id="btnGenerate" class="primary">Generate</button>
  <button id="btnLegend">Legend</button>
  <button id="btnExportJSON">JSON</button>
  <button id="btnExportCSV">CSV</button>
  <button id="btnExportPNG">PNG</button>
  <button id="btnExportPDF">PDF</button> <!-- NEW -->
</div>
...
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
...
/*** Extended Anomalies reasons ***/
const ANOMALY_EFFECTS = [
  "sensor ghosts", "energy drain", "temporal slip", "gravitic whirl", 
  "radio interference", "psychoactive field", "magnetic storms", "wormhole echoes"
];

/*** City population generator ***/
function randomPopulation(habScore){
  if(habScore<20){ // harsh: domes/outposts
    return `${(Math.floor(Math.random()*9)+1)*1000}–${(Math.floor(Math.random()*50)+1)*1000}`;
  } else if(habScore<60){ // marginal
    return `${(Math.floor(Math.random()*900)+100)}k–${(Math.floor(Math.random()*9)+1)}M`;
  } else { // habitable
    const millions = Math.floor(Math.random()*900)+100;
    const billions = Math.random()<0.5 ? "" : ` (${(Math.random()*5).toFixed(1)}B cap)`;
    return `${millions}M${billions}`;
  }
}

/*** Modify POI generator to add anomalies + city populations ***/
function genPOIsWithCities(rng, density, enabledMap, habScore){
  const out=[];
  // cities
  const maxCities=5; let cityCount=Math.floor((habScore/100)*maxCities);
  if(habScore<20 && Math.random()<(habScore/40)) cityCount=Math.max(cityCount,1);
  if(enabledMap.Cities){
    const high=["Port Halcyon","Rimwatch","Glass Harbor","Low Dock","Starwell City","New Meridian"];
    const domes=["Hab-Dome Cluster","Sealed Colony","Polar Habitat","Crater Outpost","Subglacial Base"];
    const pool = (habScore<20)?domes:high;
    for(let i=0;i<cityCount;i++){
      const name=pool[Math.floor(Math.random()*pool.length)];
      const pop=randomPopulation(habScore);
      out.push({id:`POI-${1000+Math.floor(Math.random()*9000)}`, category:"Cities",
        name, population:pop, hook:`Population approx. ${pop}`});
    }
  }
  // others
  const pools={...}; // same as Pack C
  const hooks={...}; // add anomalies line
  const countOther=Math.floor(Math.random()*Math.max(0,Math.min(5,density+2)));
  const cats=["Ruins","Geology","Anomalies","Factions","Resources"].filter(k=>enabledMap[k]);
  for(let i=0;i<countOther;i++){
    const cat=cats[Math.floor(Math.random()*cats.length)];
    let name=""; let hook="";
    if(cat==="Anomalies"){
      const eff=ANOMALY_EFFECTS[Math.floor(Math.random()*ANOMALY_EFFECTS.length)];
      name=["Grav Ripple","Signal Ghost","Aurora Node","Cold Spot"][Math.floor(Math.random()*4)];
      hook=`Region affected by ${eff}`;
    } else {
      name=pools[cat][Math.floor(Math.random()*pools[cat].length)];
      hook=hooks[cat];
    }
    out.push({id:`POI-${1000+Math.floor(Math.random()*9000)}`, category:cat, name, hook});
  }
  return out;
}

/*** PDF Export ***/
function exportPDF(sys){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y=10;
  doc.setFont("helvetica","bold"); doc.setFontSize(16);
  doc.text(sys.name,10,y); y+=8;
  doc.setFontSize(10); doc.setFont("helvetica","normal");
  doc.text(`Seed: ${sys.seed}   Preset: ${sys.preset_used}   Generated: ${sys.generated_at}`,10,y); y+=6;
  doc.text(`Stars: ${sys.system_stats.star_count}  Planets: ${sys.system_stats.planet_count}  Habitable: ${sys.system_stats.habitable_worlds}`,10,y); y+=8;
  sys.stars.forEach(s=>{ doc.text(`★ ${s.id} (${s.spectral_class})`,10,y); y+=6; });
  sys.planets.forEach(p=>{
    doc.setFont("helvetica","bold"); doc.text(`◯ ${p.id} ${p.class} (Hab ${p.habitability_score})`,10,y); y+=6;
    doc.setFont("helvetica","normal");
    if(p.pois.length){
      p.pois.forEach(q=>{ 
        const desc = q.category==="Cities" && q.population ? `${q.name} — pop. ${q.population}` : `${q.name}`;
        doc.text(` • ${q.category}: ${desc}`,15,y); y+=5;
        if(q.hook) { doc.setTextColor(100); doc.text(`   ${q.hook}`,15,y); doc.setTextColor(0); y+=5; }
      });
    }
    y+=3;
    if(y>270){ doc.addPage(); y=10; }
  });
  doc.save(`${sys.name}-${sys.seed}.pdf`);
}

/*** Wiring ***/
const btnPDF=document.getElementById('btnExportPDF');
btnPDF.addEventListener('click',()=> currentSystem && exportPDF(currentSystem));
...
</script>
